import{_ as v,u as b,c as p,a as w,d as h,e as t,t as i,h as n,q as F,l as m,v as y,m as x,s as L,k as B,w as k,f as C,g as N,j as S,o as c,i as A}from"./index-BxHXK96m.js";const _=b(),g="http://127.0.0.1:8000/api",U={name:"FlightsShow",data(){return{flight:{},class:"",type:"",confirmation:!1,bookings:[],loading:!0}},computed:{flightId(){return this.$route.params.id},useUserStore(){return b()},user(){return _}},created(){this.retrieveFlight(),_.user&&this.retrieveBookings()},methods:{retrieveFlight(){p.get(g+"/flights/"+this.$route.params.id).then(s=>{console.log(s.data),this.flight=s.data[0],this.updateMetaData()}).catch(s=>{console.error(s)}).finally(()=>{this.loading=!1})},bookFlight(){const s=b(),l={user_id:s.user.id,flight_id:Number(this.flightId||this.flight.id),seat_number:Math.floor(Math.random()*999)+1,class:this.class,type:this.type,price:Number(this.flight.price)};this.confirmation===!0?Number(s.user.wallet)>=Number(this.flight.price)?p.post(g+"/bookings",l).then(d=>{alert("Flight booked!"),console.log(d);const f=Number(d.data.flight.price),e=(Number(s.user.wallet)-f).toFixed(2),o=Math.round(Number(s.user.loyalty_points)+f),u={wallet:e,loyalty_points:o};p.put(g+"/users/"+s.user.id,u).then(a=>{console.log(a.data),s.setUser(a.data),localStorage.setItem("user",JSON.stringify(a.data))}).catch(a=>{console.error(a)});const r={available_seats:this.flight.available_seats-1};p.put(g+"/flights/"+this.flight.id,r).then(a=>{console.log(a.data),this.retrieveFlight()}).catch(a=>{console.error(a)})}).catch(d=>{console.error(d)}):alert("Insufficient wallet balance. Please top up your Wallet."):alert("Try again. Please select a Class, Type and click the checkbox to confirm.")},updateMetaData(){const l="https://www.frontair.nl"+N().path;w({title:`Flight ${this.flight.flight_number} - ${this.flight.airline.name}`,link:[{rel:"canonical",href:l}],meta:[{name:"description",content:`Book your flight ${this.flight.flight_number} with ${this.flight.airline.name}. Fly from ${this.flight.departure_airport.city}, ${this.flight.departure_airport.country} to ${this.flight.arrival_airport.city}, ${this.flight.arrival_airport.country}.`},{name:"keywords",content:`flight, ${this.flight.airline.name}, ${this.flight.flight_number}, book flight, ${this.flight.departure_airport.city}, ${this.flight.arrival_airport.city}`}],script:[{type:"application/ld+json",json:{"@context":"http://schema.org","@type":"Flight",flightNumber:this.flight.flight_number,airline:{"@type":"Airline",name:this.flight.airline.name},departureAirport:{"@type":"Airport",name:this.flight.departure_airport.city,address:{"@type":"PostalAddress",addressLocality:this.flight.departure_airport.city,addressCountry:this.flight.departure_airport.country}},arrivalAirport:{"@type":"Airport",name:this.flight.arrival_airport.city,address:{"@type":"PostalAddress",addressLocality:this.flight.arrival_airport.city,addressCountry:this.flight.arrival_airport.country}},offers:{"@type":"Offer",priceCurrency:"EUR",price:this.flight.price}}}]})},retrieveBookings(){p.get(g+"/users/"+_.user.id+"/bookings").then(s=>{console.log(s.data),this.bookings=s.data.bookings}).catch(s=>{console.error(s)})},isFlightBooked(s){if(this.bookings.length>0){for(let l=0;l<this.bookings.length;l++)if(this.bookings[l].flight_id==s)return!0}else return!1}}},I={key:0,class:"py-10"},V={class:"mx-1 grid grid-cols-1 rounded-lg bg-base-200 sm:mx-12 lg:grid-cols-3"},D=["src","alt"],M={class:"col-span-3 p-4 md:col-span-1"},j={class:"text-2xl"},E={class:"my-4"},P={class:"text-sm opacity-80"},T=t("br",null,null,-1),R={class:"text-sm opacity-80"},O=t("p",null,"Estimated times",-1),W={class:"flex flex-col gap-4 lg:flex-row"},q={class:"h-30 rounded-lg bg-base-100 p-2 lg:p-4"},H=t("p",{class:"font-bold"}," Departure ",-1),J={class:"h-30 rounded-lg bg-base-100 p-2 lg:p-4"},z=t("p",{class:"font-bold"}," Arrival ",-1),G={class:"my-4"},K={class:"my-4"},Q={class:"form-control max-w-xs"},X=t("div",{class:"label"},[t("span",{class:"label-text"},"Class")],-1),Y=t("option",{value:"Economy"},"Economy",-1),Z=t("option",{value:"Business"},"Business",-1),$=t("option",{value:"First"},"First",-1),tt=[Y,Z,$],et={class:"form-control max-w-xs"},st=t("div",{class:"label"},[t("span",{class:"label-text"},"Type")],-1),lt=t("option",{value:"one-way"},"one-way",-1),ot=t("option",{value:"round-trip"},"round-trip",-1),it=[lt,ot],rt={key:1,for:"confirmation",class:"my-4 flex gap-2"},at={key:4,class:"mt-4"},nt=t("p",null,"Flight already booked.",-1),ct={key:1,class:"py-10"},ht=A('<div class="mx-1 grid auto-rows-fr grid-cols-1 rounded-lg bg-base-200 sm:mx-12 md:auto-rows-[750px] lg:grid-cols-3"><div class="skeleton col-span-2 h-full w-full rounded-lg object-cover object-center"></div><div class="col-span-3 p-4 md:col-span-1"><h1 class="h-22 skeleton text-transparent"> Lorem ipsum </h1><p class="skeleton mt-4 text-2xl text-transparent"> Lorem </p><p class="skeleton my-4 text-transparent"> Lorem ipsum <br> Lorem ipsum </p><p class="skeleton mb-4 mt-2 text-transparent"> Estimated times </p><div class="flex flex-col gap-4 lg:flex-row"><div class="h-30 skeleton rounded-lg p-2 text-transparent lg:p-4"><p class="font-bold"> Departure </p> Lorem ipsum dolor sit </div><div class="h-30 skeleton rounded-lg p-2 text-transparent lg:p-4"><p class="font-bold"> Arrival </p> Lorem ipsum dolor sit </div></div><p class="skeleton my-4 text-transparent"> Airline </p><p class="skeleton my-4 text-transparent"> Seats available </p><form class="my-4 flex w-full flex-col gap-0 lg:flex-row lg:gap-4"><label class="form-control max-w-xs"><div class="label"><span class="label-text skeleton text-transparent">Class</span></div><select class="select skeleton min-w-[150px] text-transparent caret-primary outline-none transition-colors focus:border-primary focus:outline-none"></select></label><label class="form-control max-w-xs"><div class="label"><span class="label-text skeleton text-transparent">Type</span></div><select class="select skeleton min-w-[150px] text-transparent caret-primary outline-none transition-colors focus:border-primary focus:outline-none"></select></label></form><label class="my-4 flex gap-2"><input type="checkbox" class="checkbox skeleton text-transparent"><span class="skeleton text-transparent">Confirm</span></label><button class="btn skeleton w-full text-transparent sm:w-1/2 md:w-auto"> Book Flight </button></div></div>',1),dt=[ht];function pt(s,l,d,f,e,o){const u=S("RouterLink");return e.flight&&!e.loading?(c(),h("section",I,[t("div",V,[t("img",{class:"col-span-2 hidden h-full w-full rounded-lg object-cover object-center sm:block",src:"../src/assets/images/airlines/"+e.flight.airline.name.toLowerCase().replace(/\s/g,"_")+"/"+e.flight.image+".webp",alt:e.flight.airline.name!=null?e.flight.airline.name:"Image of Airline"},null,8,D),t("div",M,[t("h1",null,i(e.flight.flight_number)+" - "+i(e.flight.airline.icao),1),t("p",j," Price: â‚¬"+i(e.flight.price),1),t("p",E,[n(" From: "+i(e.flight.departure_airport.name)+" ",1),t("span",P,"("+i(e.flight.departure_airport.city)+", "+i(e.flight.departure_airport.country)+")",1),T,n(" To: "+i(e.flight.arrival_airport.name)+" ",1),t("span",R,"("+i(e.flight.arrival_airport.city)+", "+i(e.flight.arrival_airport.country)+")",1)]),O,t("div",W,[t("div",q,[H,n(" "+i(e.flight.departure_time),1)]),t("div",J,[z,n(" "+i(e.flight.arrival_time),1)])]),t("p",G," Airline: "+i(e.flight.airline.name),1),t("p",K," Seats available: "+i(e.flight.available_seats),1),o.user.isLoggedIn&&!o.isFlightBooked(e.flight.id)?(c(),h("form",{key:0,class:"my-4 flex w-full flex-col gap-0 lg:flex-row lg:gap-4",onSubmit:l[2]||(l[2]=F((...r)=>o.bookFlight&&o.bookFlight(...r),["prevent"]))},[t("label",Q,[X,m(t("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>this.class=r),class:"select select-bordered w-full border caret-primary outline-none transition-colors focus:border-primary focus:outline-none"},tt,512),[[y,this.class]])]),t("label",et,[st,m(t("select",{"onUpdate:modelValue":l[1]||(l[1]=r=>e.type=r),class:"select select-bordered w-full border caret-primary outline-none transition-colors focus:border-primary focus:outline-none"},it,512),[[y,e.type]])])],32)):x("",!0),o.user.isLoggedIn&&!o.isFlightBooked(e.flight.id)?(c(),h("label",rt,[m(t("input",{id:"confirmation","onUpdate:modelValue":l[3]||(l[3]=r=>e.confirmation=r),type:"checkbox",name:"confirmation",class:"checkbox"},null,512),[[L,e.confirmation]]),n(" Confirm ")])):x("",!0),o.user.isLoggedIn&&!o.isFlightBooked(e.flight.id)?(c(),h("button",{key:2,type:"submit",class:"btn btn-primary w-full sm:w-1/2 md:w-auto",onClick:l[4]||(l[4]=(...r)=>o.bookFlight&&o.bookFlight(...r))}," Book Flight ")):o.user.isLoggedIn?(c(),h("div",at,[nt,C(u,{to:{name:"bookings.index"},class:"btn btn-warning w-full sm:w-1/2 md:w-auto"},{default:k(()=>[n(" View booking ")]),_:1},8,["to"])])):(c(),B(u,{key:3,to:{name:"login"},class:"btn btn-warning w-full sm:w-1/2 md:w-auto"},{default:k(()=>[n(" Login to book ")]),_:1}))])])])):(c(),h("section",ct,dt))}const ut=v(U,[["render",pt]]);export{ut as default};
